---
title: 'Estudi GLOBALDIAB2'
author: "Jordi Real & Rai Puig"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

params:
  dir_dades_desti: "dades/mostra"
---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****

## Fase Preparacion

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")

gc()
# libreries i funcions
#rm(list=ls())

#devtools::install_github("USR-DAPCAT/Platan")
#devtools::install_github("USR-DAPCAT/FormatGe")
#devtools::install_github("USR-DAPCAT/Macedonia")
#devtools::install_github("USR-DAPCAT/ggflowchart2")

library("dplyr")
library("lubridate")
library("compareGroups")
library("FormatGe")
library("ggflowchart2")
library("Macedonia")

#
# Llegir plana
dades<-readRDS(here::here(params$dir_dades_desti,"dt_plana.rds")) %>% as_tibble()




```



## 1b. Recodificaciones y calculos [Parte demografica: dt_poblacio,dt_tabaquisme]
```{r recodificacions2 }


#general

#1)EDAT
dt_plana<-dt_plana %>% mutate(age=as.numeric(lubridate::ymd(dtindex)-lubridate::ymd(dnaix))/365.25)
#2)EDAT-->age2.cat: <30,[30-56),[56-75),>=75

dt_plana<-dt_plana %>% mutate(age2.cat=case_when(age>=15 & age<20~ "age>=15 & age<20",
                                                 age>=20 & age<25 ~ "age>=20 & age<25",
                                                 age>=25 & age<30 ~ "age>=25 & age<30",
                                                 age>=30 & age<35 ~ "age>=30 & age<35",
                                                 age>=35 & age<40 ~ "age>=35 & age<40",
                                                 age >=40~ "age >=40" ))


dt_plana<-dt_plana%>%mutate(age_youngDM2=case_when(age<40 ~ "Yes",age>=40 ~ "No"))


```


## 4. Salvar tabla plana

```{r salvar}

saveRDS(dt_plana, file=here::here(params$dir_dades_desti,"dt_plana2.rds"))

```


&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>

